<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Registrar Disciplinas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Fonte Montserrat */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
            background: #f1f0ea;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            /* Adicionado padding-top para compensar header fixo que será injetado */
            padding-top: 90px;
        }

        /* ESTILOS DE HEADER, SIDEBAR E OVERLAY REMOVIDOS DAQUI */
        /* Mantidos apenas estilos específicos desta página */

        .primeiro-bloco {
             /* padding-top ajustado pois o geral do body já compensa */
            padding-top: 0px;
        }

        section {
            margin-bottom: 2rem;
            border-radius: 8px;
        }

        h2 {
            font-weight: bold;
            padding-top: 0px; /* Ajustado */
            margin-bottom: 15px; /* Adicionado espaço */
            color: #474c5f;
        }
        h2.subtitulo { /* Estilo específico para o subtítulo da lista */
             margin-top: 50px;
             margin-bottom: 20px;
        }

        input[type="text"] { /* Específico para o input de disciplina */
            padding: 10px;
            font-size: 16px;
            margin-top: 0px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-right: 5px; /* Espaço antes do botão */
            min-width: 250px; /* Largura mínima */
        }

        button { /* Estilo base para botões da página */
            font-family: 'Montserrat';
            background-color: #474c5f;
            color: white;
            cursor: pointer;
            padding: 10px 15px; /* Ajustado padding */
            font-size: 14px; /* Tamanho da fonte */
            border: none;
            border-radius: 6px; /* Consistente com input */
            margin-top: 0px; /* Alinhado com input */
            margin-right: 5px;
            vertical-align: middle; /* Alinha com input */
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #542aa3;
        }

        #disciplinasContainer ul { /* Estilos para a lista dentro dos blocos */
            margin-top: 10px; /* Ajustado */
            padding-left: 20px;
        }

        #disciplinasContainer li {
            margin-bottom: 12px;
        }

        .topicos {
            margin-top: 10px; /* Ajustado */
            padding-left: 15px;
            color: #555; /* Cor mais suave */
            font-size: 0.9em; /* Menor */
        }

        .disciplina-bloco {
            border: 1px solid #e0e0e0; /* Borda mais suave */
            border-radius: 8px;
            margin-bottom: 15px; /* Mais espaço */
            padding: 15px; /* Mais padding */
            cursor: pointer;
            background: #fff; /* Fundo branco */
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .disciplina-bloco strong { /* Estilo para o nome da disciplina */
             font-weight: 600;
             color: #542aa3; /* Roxo */
             font-size: 1.1em;
        }

        .disciplina-bloco.minimizado .topicos {
            display: none;
        }

        .disciplina-bloco.maximizado .topicos {
            display: block;
        }

        .confirmar-cancelar { display: none; margin-top: 10px;}
        .confirmar-cancelar.show { display: block; }
        .botao-adicionar-excluir { margin-top: 10px;}
        .botao-adicionar-excluir.hide { display: none; }

        .lixeira { display: none; cursor: pointer; margin-left: 10px; color: #e53935; /* Vermelho */}
        .lixeira:hover { color: #c62828; }
        .topico-lixeira.show, .disciplina-lixeira.show { display: inline; }

        .rotate { transition: transform 0.4s ease; display: inline-block; /* Para a rotação funcionar bem */}
        .rotate.open { transform: rotate(45deg); } /* Rotação 45 graus para virar 'x' */

        .btn-excluir, .btn-add, .btn-minimizar { /* Estilos comuns para botões internos */
             background: none;
             border: none;
             cursor: pointer;
             padding: 5px;
             margin: 0 5px 0 0; /* Ajuste margens */
             vertical-align: middle;
        }
         .btn-add { color: #4caf50; /* Verde */}
         .btn-excluir { color: #e53935; /* Vermelho */}
         .btn-minimizar { color: #757575; /* Cinza */}
         .btn-minimizar i { font-size: 1em; /* Ajuste tamanho ícone +/- */ }
         .btn-add i, .btn-excluir i { font-size: 0.9em;}

        #caixa-disciplinas {
            padding-top: 0px;
        }

    </style>
</head>
<body>
    <section class="primeiro-bloco">
        <h2>Registrar Disciplinas</h2>
        <input type="text" id="nomeDisciplina" placeholder="Nome da disciplina">
        <button onclick="adicionarDisciplina()">Adicionar Disciplina</button>
    </section>

    <section id="caixa-disciplinas" >
       <h2 class="subtitulo"><i class="fa-solid fa-list-check"></i> Minhas disciplinas</h2>
       <div class="disciplinas-container" id="disciplinasContainer"></div>
    </section>

    <script src="assets/js/components/header.js"></script>

    <script>
        // LÓGICA DA SIDEBAR REMOVIDA DAQUI

        let disciplinas = JSON.parse(localStorage.getItem('disciplinas')) || [];

        function removerAcentuacao(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function adicionarDisciplina() {
            const nomeInput = document.getElementById('nomeDisciplina');
            const nome = nomeInput.value.trim();
            if (nome === "") return;
            const nomeSemAcento = removerAcentuacao(nome).toLowerCase();
            const nomeExiste = disciplinas.some(d => removerAcentuacao(d.nome).toLowerCase() === nomeSemAcento);
            if (nomeExiste) {
                alert("Essa disciplina já está registrada.");
                nomeInput.value = "";
                return;
            }
            disciplinas.push({ nome: nome, topicos: [], maximizado: false, excluirAtivo: false });
            localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
            nomeInput.value = "";
            exibirDisciplinas();
        }

        function alternarVisibilidade(index) {
            const disciplina = disciplinas[index];
            disciplina.maximizado = !disciplina.maximizado;
            // Não salva estado maximizado no localStorage, reseta ao recarregar
            // localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
            exibirDisciplinas(); // Re-renderiza para aplicar classe e mostrar/ocultar botões
        }


        function adicionarTopico(index) {
            const topico = prompt("Digite o tópico:");
            if (topico && topico.trim() !== "") { // Verifica se não é nulo ou vazio
                // Adiciona ao início da lista para aparecer primeiro
                disciplinas[index].topicos.unshift(topico.trim());
                localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
                // Força a re-exibição mantendo o bloco aberto
                disciplinas[index].maximizado = true;
                exibirDisciplinas();
            }
        }


        function ativarExclusao(index) {
            disciplinas.forEach((d, i) => { d.excluirAtivo = (i === index); }); // Ativa só neste, desativa outros
            // Não salva estado de exclusão no localStorage
            // localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
            exibirDisciplinas();
        }

        function cancelarExclusao(index) {
            if(disciplinas[index]) { // Verifica se ainda existe
                 disciplinas[index].excluirAtivo = false;
                 // localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
                 exibirDisciplinas();
            }
        }

        // Função única para pedir confirmação e excluir
        function pedirConfirmacaoExcluir(tipo, indexDisciplina, indexTopico = null) {
            const mensagem = tipo === 'disciplina'
                ? `Tem certeza de que deseja excluir a disciplina "${disciplinas[indexDisciplina]?.nome}" e todos os seus tópicos?`
                : `Tem certeza de que deseja excluir o tópico "${disciplinas[indexDisciplina]?.topicos[indexTopico]}"?`;

            if (confirm(mensagem)) {
                if (tipo === 'disciplina') {
                    disciplinas.splice(indexDisciplina, 1);
                } else if (tipo === 'topico' && indexTopico !== null) {
                    disciplinas[indexDisciplina].topicos.splice(indexTopico, 1);
                }
                localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
                exibirDisciplinas();
            } else if (tipo === 'disciplina') {
                 // Se cancelou a exclusão da disciplina, volta ao estado normal
                 cancelarExclusao(indexDisciplina);
            }
        }


        function exibirDisciplinas() {
            const container = document.getElementById('disciplinasContainer');
            container.innerHTML = "";

            if (disciplinas.length === 0) {
                container.innerHTML = "<p style='text-align: center; color: #888;'>Nenhuma disciplina registrada.</p>";
                return;
            }

            disciplinas.forEach((disciplina, index) => {
                const bloco = document.createElement('div');
                 // Usa o estado atual (não salvo) para maximizado e excluirAtivo
                const isMaximizado = disciplina.maximizado === true;
                 const isExcluirAtivo = disciplina.excluirAtivo === true;
                bloco.className = `disciplina-bloco ${isMaximizado ? 'maximizado' : 'minimizado'}`;

                // Constrói o HTML dos tópicos
                 let topicosHtml = '<p style="font-size: 0.8em; color: #999;">Nenhum tópico adicionado.</p>'; // Mensagem padrão
                 if (disciplina.topicos.length > 0) {
                     topicosHtml = disciplina.topicos.map((topico, topicoIndex) => `
                         <li>
                             ${topico}
                             <span class="lixeira topico-lixeira ${isExcluirAtivo ? 'show' : ''}" onclick="pedirConfirmacaoExcluir('topico', ${index}, ${topicoIndex})">
                                 <i class="fas fa-trash-alt"></i>
                             </span>
                         </li>
                     `).join('');
                     topicosHtml = `<ul>${topicosHtml}</ul>`; // Envolve em UL apenas se houver tópicos
                 }


                // Constrói o HTML dos botões de ação (variam se está maximizado ou em modo de exclusão)
                let acoesHtml = '';
                if (isMaximizado) {
                    if (isExcluirAtivo) {
                        acoesHtml = `
                            <div class="confirmar-cancelar show">
                                <button title="Confirmar Exclusão da Disciplina" class="btn-excluir" onclick="pedirConfirmacaoExcluir('disciplina', ${index})"><i class="fas fa-check"></i> Confirmar Exclusão</button>
                                <button title="Cancelar Exclusão" class="btn-excluir" onclick="cancelarExclusao(${index})"><i class="fas fa-times"></i> Cancelar</button>
                            </div>`;
                    } else {
                        acoesHtml = `
                            <div class="botao-adicionar-excluir">
                                <button title="Adicionar Novo Tópico" class="btn-add" onclick="adicionarTopico(${index})"><i class="fas fa-plus"></i> Adicionar Tópico</button>
                                <button title="Excluir Disciplina/Tópicos" class="btn-excluir" onclick="ativarExclusao(${index})"><i class="fas fa-trash"></i> Excluir</button>
                            </div>`;
                    }
                }

                // Monta o bloco completo
                bloco.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                         <strong>${disciplina.nome}</strong>
                         <button class="btn-minimizar" title="${isMaximizado ? 'Minimizar' : 'Maximizar'}" onclick="alternarVisibilidade(${index})">
                             <i id="icone-${index}" class="fas fa-plus rotate ${isMaximizado ? 'open' : ''}"></i>
                         </button>
                    </div>
                    <div class="topicos">
                        ${topicosHtml}
                    </div>
                    ${acoesHtml}
                `;

                container.appendChild(bloco);
            });
        }


        // Exibir disciplinas ao carregar a página
        document.addEventListener('DOMContentLoaded', exibirDisciplinas);

    </script>
</body>
</html>
